<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مود كيدز - إدارة المنتجات</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ... (tout le CSS inchangé, tu peux copier comme l’original) ... */
        /* ... pour gagner de la place ici, car il est déjà bien structuré ... */
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- الشريط الجانبي -->
        <aside class="sidebar" id="sidebar">
            <!-- ... sidebar inchangée ... -->
        </aside>

        <!-- المحتوى الرئيسي -->
        <main class="main-content">
            <!-- الهيدر -->
            <header class="admin-header">
                <!-- ... header inchangé ... -->
            </header>

            <div class="products-content">
                <!-- شبكة المنتجات -->
                <section class="products-grid-section">
                    <!-- ... section header inchangée ... -->
                    <div class="products-grid" id="productsGrid">
                        <!-- سيتم ملؤها ديناميكياً -->
                    </div>
                    <div class="loading" id="productsLoading">
                        <div class="loading-spinner"></div>
                        <p>جاري تحميل المنتجات...</p>
                    </div>
                </section>

                <!-- نموذج إدارة المنتج -->
                <section class="product-form-section">
                    <h2 class="section-title" id="productFormTitle">
                        <i class="fas fa-edit"></i>
                        إضافة منتج جديد
                    </h2>

                    <div class="form-group">
                        <label for="productName">اسم المنتج</label>
                        <input type="text" id="productName" placeholder="اسم المنتج">
                    </div>

                    <div class="form-group">
                        <label for="productDescription">وصف المنتج</label>
                        <textarea id="productDescription" placeholder="وصف مختصر للمنتج..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="productPrice">السعر (دج)</label>
                        <input type="number" id="productPrice" placeholder="0">
                    </div>

                    <div class="form-group">
                        <label>الألوان المتاحة</label>
                        <div class="colors-grid" id="colorsGrid">
                            <div class="color-option" style="background: #FFFFFF;" data-color="أبيض" onclick="selectColor(this)"></div>
                            <div class="color-option" style="background: #000000;" data-color="أسود" onclick="selectColor(this)"></div>
                            <div class="color-option" style="background: #6B7280;" data-color="رمادي" onclick="selectColor(this)"></div>
                            <div class="color-option" style="background: #3B82F6;" data-color="أزرق" onclick="selectColor(this)"></div>
                            <div class="color-option" style="background: #EF4444;" data-color="أحمر" onclick="selectColor(this)"></div>
                            <div class="color-option" style="background: #10B981;" data-color="أخضر" onclick="selectColor(this)"></div>
                            <div class="color-option" style="background: #EC4899;" data-color="زهري" onclick="selectColor(this)"></div>
                            <div class="color-option" style="background: #8B5CF6;" data-color="بنفسجي" onclick="selectColor(this)"></div>
                        </div>
                        <input type="text" id="selectedColors" style="display: none;">
                    </div>

                    <div class="form-group">
                        <label>المقاسات المتاحة</label>
                        <div class="sizes-grid" id="sizesGrid">
                            <div class="size-option" data-size="S1" onclick="selectSize(this)">S1</div>
                            <div class="size-option" data-size="S2" onclick="selectSize(this)">S2</div>
                            <div class="size-option" data-size="S3" onclick="selectSize(this)">S3</div>
                            <div class="size-option" data-size="S4" onclick="selectSize(this)">S4</div>
                            <div class="size-option" data-size="S5" onclick="selectSize(this)">S5</div>
                            <div class="size-option" data-size="S6" onclick="selectSize(this)">S6</div>
                        </div>
                        <input type="text" id="selectedSizes" style="display: none;">
                    </div>

                    <div class="form-group">
                        <label>صورة المنتج</label>
                        <div class="image-upload" onclick="document.getElementById('productImageUpload').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <div>انقر لرفع صورة</div>
                            <input type="file" id="productImageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
                        </div>
                        <div id="imagePreview" style="margin-top: 0.5rem;"></div>
                    </div>

                    <div class="form-group">
                        <label for="productStatus">حالة المنتج</label>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <label class="switch">
                                <input type="checkbox" id="productStatus" checked>
                                <span class="slider"></span>
                            </label>
                            <span>منشور</span>
                        </div>
                    </div>

                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-success btn-full" onclick="saveProduct()" style="flex: 1;">
                            <i class="fas fa-save"></i> حفظ
                        </button>
                        <button class="btn btn-secondary" onclick="resetForm()" style="display: none;" id="cancelEdit">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid #e2e8f0;">

                    <div class="form-group">
                        <label>استيراد/تصدير</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-warning btn-full" onclick="importProducts()">
                                <i class="fas fa-file-import"></i> استيراد
                            </button>
                            <button class="btn btn-primary btn-full" onclick="exportProducts()">
                                <i class="fas fa-file-export"></i> تصدير
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        const APP_CONFIG = {
            SHEET_URL: 'https://script.google.com/macros/s/AKfycbwesUdUw4bZEQHhemywUh0q2jMUe74emKnrcRzq9-kibNMySIyfvlgcbeiq-wYdCn5sHA/exec'
        };

        let products = [];
        let editingProduct = null; // initialisation

        let selectedColors = [];
        let selectedSizes = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
        });

        // ... (tout le reste du JS inchangé) ...

        // Modifier le titre dynamiquement selon l’état du formulaire
        function updateProductFormTitle() {
            const titleEl = document.getElementById('productFormTitle');
            if (editingProduct) {
                titleEl.innerHTML = '<i class="fas fa-edit"></i> تعديل المنتج';
                document.getElementById('cancelEdit').style.display = 'block';
                document.querySelector('.btn-success').innerHTML = '<i class="fas fa-save"></i> تحديث';
            } else {
                titleEl.innerHTML = '<i class="fas fa-edit"></i> إضافة منتج جديد';
                document.getElementById('cancelEdit').style.display = 'none';
                document.querySelector('.btn-success').innerHTML = '<i class="fas fa-save"></i> حفظ';
            }
        }

        // Appeler la fonction à chaque fois qu’on change l’état
        function editProduct(productId) {
            const product = products.find(p => p.id == productId);
            if (product) {
                editingProduct = productId;
                // ... (le reste inchangé) ...
                updateProductFormTitle();
            }
        }

        function resetForm() {
            // ... (le reste inchangé) ...
            editingProduct = null;
            updateProductFormTitle();
        }

        // Appeler updateProductFormTitle() au chargement initial
        document.addEventListener('DOMContentLoaded', updateProductFormTitle);

        // ... (tout le reste inchangé) ...
    </script>
</body>
</html>
